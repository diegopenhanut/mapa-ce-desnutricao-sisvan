<!DOCTYPE html>
<meta charset="utf-8">
<head>
<title>Desnutrição no Ceará, 2015, SISVANweb</title>
<style>
#controles{
float: left;
padding: 70px 0;
height: 600px;
}
svg{
position: auto 
}
.navbar-inverse {
    background-color: #222;
    border-color: #080808;
}

</style>
<script src="//d3js.org/d3.v3.min.js" charset="utf-8"></script></script>
<script src="//d3js.org/topojson.v1.min.js"></script>

<!-- Jquery from google-->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script> 

<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

<!-- Optional theme -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">

<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>

</head>

<body>
	<div id="navbar navbar-inverse navbar-fixed-top"> 
		<h1>Porcentagem de Adultos Desnutridos em Atendimentos Registrados no SISVANweb, 2015</h1>
	</div>


<div id="controles" >

<button id="get_list_btn" onclick="GetList();">Colorir mapa</button>
</br>
Pontos de Corte
</br>
<input type="text" id="limits_list" value="1; 2; 3; 4"</input>
</br>
Cores para pontos de corte
</br>
<input type="text" id="colors_list" value="blue; green; yellow; orange; red"</input>
</br>
Lista com municipios e Valores
</br>
<textarea id="municipios_list" style="width:200px;height:200px" >ABAIARA	;	2.74
ACARAPE	;	2.23
ACARAÚ	;	1.75
ACOPIARA	;	3.86
AIUABA	;	2.18
ALCÂNTARAS	;	2.06
ALTANEIRA	;	2.57
ALTO SANTO	;	2.44
AMONTADA	;	2.44
ANTONINA DO NORTE	;	4.39
APUIARÉS	;	2.4
AQUIRAZ	;	1.71
ARACATI	;	2.89
ARACOIABA	;	2.1
ARARENDÁ	;	3.69
ARARIPE	;	2.38
ARATUBA	;	1.89
ARNEIROZ	;	2.41
ASSARÉ	;	3.42
AURORA	;	3.69
BAIXIO	;	4.05
BANABUIÚ	;	2.59
BARBALHA	;	3.46
BARREIRA	;	2.27
BARRO	;	3.02
BARROQUINHA	;	3.46
BATURITÉ	;	2.54
BEBERIBE	;	2.18
BELA CRUZ	;	2.39
BOA VIAGEM	;	2.9
BREJO SANTO	;	2.99
CAMOCIM	;	2.15
CAMPOS SALES	;	3.89
CANINDÉ	;	3.36
CAPISTRANO	;	2.05
CARIDADE	;	2.58
CARIRÉ	;	2.69
CARIRIAÇU	;	3.34
CARIÚS	;	3.16
CARNAUBAL	;	2.1
CASCAVEL	;	2.68
CATARINA	;	5.26
CATUNDA	;	9.07
CAUCAIA	;	1.95
CEDRO	;	3.63
CHAVAL	;	3.09
CHORÓ	;	3.14
CHOROZINHO	;	2.94
COREAÚ	;	2.24
CRATEÚS	;	3.22
CRATO	;	3.18
CROATÁ	;	2.08
CRUZ	;	2.24
DEPUTADO IRAPUAN PINHEIRO	;	1.88
ERERÊ	;	3.25
EUSÉBIO	;	2.42
FARIAS BRITO	;	3.64
FORQUILHA	;	2.4
FORTALEZA	;	1.95
FORTIM	;	1.7
FRECHEIRINHA	;	3.59
GENERAL SAMPAIO	;	2.09
GRAÇA	;	2.3
GRANJA	;	4.1
GRANJEIRO	;	4.06
GROAÍRAS	;	3.31
GUAIÚBA	;	1.86
GUARACIABA DO NORTE	;	3.13
GUARAMIRANGA	;	1.76
HIDROLÂNDIA	;	3.6
HORIZONTE	;	1.83
IBARETAMA	;	3.66
IBIAPINA	;	3.37
IBICUITINGA	;	1.96
ICAPUÍ	;	1.62
ICÓ	;	4.06
IGUATU	;	3.21
INDEPENDÊNCIA	;	3.09
IPAPORANGA	;	4.61
IPAUMIRIM	;	2.43
IPU	;	2.49
IPUEIRAS	;	2.91
IRACEMA	;	2.65
IRAUÇUBA	;	1.68
ITAIÇABA	;	2.22
ITAITINGA	;	1.98
ITAPAGÉ	;	2.01
ITAPIPOCA	;	2.86
ITAPIÚNA	;	2.54
ITAREMA	;	1.64
ITATIRA	;	3.01
JAGUARETAMA	;	3.63
JAGUARIBARA	;	2.15
JAGUARIBE	;	3.34
JAGUARUANA	;	2.97
JARDIM	;	2.83
JATI	;	1.83
JIJOCA DE JERICOACOARA	;	1.82
JUAZEIRO DO NORTE	;	2.94
JUCÁS	;	3.18
LAVRAS DA MANGABEIRA	;	4.14
LIMOEIRO DO NORTE	;	2.28
MADALENA	;	2.31
MARACANAÚ	;	2.2
MARANGUAPE	;	2.33
MARCO	;	2.35
MARTINÓPOLE	;	2.53
MASSAPÊ	;	3.19
MAURITI	;	5.05
MERUOCA	;	1.96
MILAGRES	;	2.62
MILHÃ	;	2.66
MIRAÍMA	;	2.74
MISSÃO VELHA	;	2.9
MOMBAÇA	;	4.05
MONSENHOR TABOSA	;	2.17
MORADA NOVA	;	2.2
MORAÚJO	;	2.91
MORRINHOS	;	1.26
MUCAMBO	;	2.48
MULUNGU	;	2.13
NOVA OLINDA	;	2.66
NOVA RUSSAS	;	3.3
NOVO ORIENTE	;	3.39
OCARA	;	1.84
ORÓS	;	4.02
PACAJUS	;	1.84
PACATUBA	;	2.32
PACOTI	;	1.43
PACUJÁ	;	4.53
PALHANO	;	1.99
PALMÁCIA	;	3.06
PARACURU	;	2.76
PARAIPABA	;	1.63
PARAMBU	;	2.66
PARAMOTI	;	2.89
PEDRA BRANCA	;	2.21
PENAFORTE	;	3.38
PENTECOSTE	;	2.79
PEREIRO	;	2.05
PINDORETAMA	;	1.85
PIQUET CARNEIRO	;	2.59
PIRES FERREIRA	;	3.46
PORANGA	;	3.45
PORTEIRAS	;	3.02
POTENGI	;	3.3
POTIRETAMA	;	3.44
QUITERIANÓPOLIS	;	3.78
QUIXADÁ	;	2.77
QUIXELÔ	;	4.26
QUIXERAMOBIM	;	2.95
QUIXERÉ	;	2.58
REDENÇÃO	;	0.62
RERIUTABA	;	2.61
RUSSAS	;	2.45
SABOEIRO	;	5.17
SALITRE	;	3.21
SANTA QUITÉRIA	;	3.05
SANTANA DO ACARAÚ	;	3.47
SANTANA DO CARIRI	;	2.83
SÃO BENEDITO	;	2.06
SÃO GONÇALO DO AMARANTE	;	2.26
SÃO JOÃO DO JAGUARIBE	;	2.6
SÃO LUÍS DO CURU	;	3.71
SENADOR POMPEU	;	2.63
SENADOR SÁ	;	1.5
SOBRAL	;	2.31
SOLONÓPOLE	;	2.41
TABULEIRO DO NORTE	;	2.64
TAMBORIL	;	2.96
TARRAFAS	;	2.59
TAUÁ	;	3.27
TEJUÇUOCA	;	1.9
TIANGUÁ	;	0.99
TRAIRI	;	2.54
TURURU	;	2.33
UBAJARA	;	2.13
UMARI	;	3.76
UMIRIM	;	1.79
URUBURETAMA	;	1.36
URUOCA	;	2.61
VARJOTA	;	4.39
VÁRZEA ALEGRE	;	2.8
VIÇOSA DO CEARÁ	;	1.97</textarea>



</div>

<script>

var width = 600,
    height = 600;

var projection = d3.geo.albers()
    .center([0, 0])
    .rotate([39, 5])
    .parallels([20, 0])
    .scale(1000 * 5)
    .translate([width / 2, height / 2]);

var path = d3.geo.path()
    .projection(projection);

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height);
    

d3.json("ce-municipalities.json", function(error, ce) {
 svg.selectAll(".municipalities")
      .data(topojson.feature(ce, ce.objects.municipalities).features)
    .enter().append("path")
      .attr("class", function(d) { return "municipalities " + d.id; })
      .attr("d", path)
      .style("fill", "white")
      .style("stroke", "black")
    .append("title")
       .attr("x", 10)
       .attr("dy", ".35em")
       .text(function(d) { return d.properties.name; });


});

function name(d) {
	return d.properties.name;
}

//function getNameFromMap(municipality){
//	return municipality.properties.name
//}

var limits = document.getElementById("limits_list").value.split(/\s*;\s*/);
var colors = document.getElementById("colors_list").value.split(/\s*;\s*/);

var color = d3.scale.threshold()
	    .domain(limits)
	    .range(colors);

function GetList(){
	var output = [];
	var str = document.getElementById('municipios_list').value;
	var line = str.split("\n");
	for (var i = 0; i < line.length; i++){
		var innerSplit = line[i].split(/\s*;\s*/);
		var municipio = innerSplit[0].trim();
		var value = innerSplit[1].trim();
		var innerObj = {};
		innerObj.properties = {};
		innerObj.properties.name = municipio;
		innerObj.properties.value = value;
		output.push(innerObj);
	};
	console.log(output);
	d3.selectAll(".municipalities")
      		.data(output, name)
		.style("fill", function(d){
			mycolor = d.properties.value;
			return color(mycolor);
		});
	// Create Legend
	for (var i = 0; i < colors.length; i++){
		var legText;

		svg.append("rect")
			.attr("width", 20)
			.attr("height", 10)
			.attr("x", 50)
			.attr("y", (i * 15) + 10 )
			.style("fill", colors[i])
			.style("stroke", "black")
		
		if (i == 0){
			legText = "< " + limits[i] + "%";
		} else if (i === (colors.length - 1)){      
			legText = "> " + limits[i - 1] + "%";
		} else {
			legText = limits[i-1] + "% - " + limits[i] + "%";
		}
		
		svg.append("text")
			.attr("x", 80)
			.attr("y", (i * 15) + 20 )
			.text(legText)
	}

	return output;
}

</script>

</body>

